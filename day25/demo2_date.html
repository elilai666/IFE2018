<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Date</title>
</head>
<body>
<select id="year-select">
    <option value="2000">2000</option>
    <option value="2001">2001</option>
    <option value="2002">2002</option>
    <option value="2010">2010</option>
    <option value="2012">2012</option>
    <option value="2018" selected>2018</option>
    <option value="2020">2020</option>
</select>

<select id="month-select">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
</select>

<select id="day-select">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
</select>

<select id="hour-select">
    <option value="00">00</option>
    <option value="01">01</option>
    <option value="02">02</option>
    <option value="03">03</option>
    <option value="04">04</option>
    <option value="05">05</option>
    <option value="06">06</option>
    <option value="07">07</option>
    <option value="08">08</option>
    <option value="09">09</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
</select>

<select id="minute-select">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">50</option>
    <option value="51">51</option>
    <option value="52">52</option>
    <option value="53">53</option>
    <option value="54">54</option>
    <option value="55">55</option>
    <option value="56">56</option>
    <option value="57">57</option>
    <option value="58">58</option>
    <option value="59">59</option>
</select>

<select id="second-select">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">50</option>
    <option value="51">51</option>
    <option value="52">52</option>
    <option value="53">53</option>
    <option value="54">54</option>
    <option value="55">55</option>
    <option value="56">56</option>
    <option value="57">57</option>
    <option value="58">58</option>
    <option value="59">59</option>
</select>

<p id="result-wrapper">现在距离 2001年1月1日星期X HH:MM:SS 还有 X 天 X 小时 X 分 X 秒</p>
</body>
<script !src="">
   /* 当变更任何一个select选择时，更新 result-wrapper 的内容
    当所选时间早于现在时间时，文案为 现在距离 "所选时间" 已经过去 xxxx
    当所选时间晚于现在时间时，文案为 现在距离 "所选时间" 还有 xxxx
    注意当前时间经过所选时间时候的文案变化
    注意选择不同月份的时候，日期的可选范围不一样，比如1月可以选31天，11月只有30天，注意闰年
    同样，需要注意，通过优雅的函数封装，使得代码更加可读且可维护*/
   var result = document.getElementById("result-wrapper");
   var select_year = document.getElementById("year-select");
   var select_month = document.getElementById("month-select");
   var select_day = document.getElementById("day-select");
   var select_hour = document.getElementById("hour-select");
   var select_minute = document.getElementById("minute-select");
   var select_second = document.getElementById("second-select");

   setInterval(refreshTime, 500);

   function refreshTime() {
       let inputDate = new Date(select_year.value, select_month.value - 1, select_day.value,
           select_hour.value, select_minute.value, select_second.value);
       result.innerText = "现在距离" + transformDate(inputDate) +  getDuringTime(inputDate);
   }
   function getDuringTime(date) {
       let now = new Date();
       let tot_ms = date - now;
       let flag;
       if (tot_ms >= 0) {
           flag = "还有";
       } else {
           flag = "已经过去";
       }
       tot_ms = Math.abs(tot_ms);
       let dur_s = Math.floor(tot_ms / 1000) % 60;
       let dur_m = Math.floor(tot_ms / (1000 * 60)) % 60;
       let dur_h = Math.floor(tot_ms / (1000 * 60 * 60)) % 24;
       let dur_d = Math.floor(tot_ms / (1000 * 60 * 60 * 24));

       return flag + dur_d + "天" + dur_h + "小时" + dur_m + "分" + dur_s + "秒";
   }

   function transformDate(date) {
       let year = date.getFullYear();
       let month = formatTime(date.getMonth() + 1);
       let day = formatTime(date.getDate());
       let dayOfWeek = date.getDayOfWeek("cn");
       let hour = formatTime(date.getHours());
       let min = formatTime(date.getMinutes());
       let sec = formatTime(date.getSeconds());
       return year + "年" + month + "月" + day + "日" + " " + dayOfWeek + " " + hour + ":" + min + ":" + sec;
   }
   // 封装一个函数，把月、日、小时等出现个位数的情况前面补充0，补充为两位，比如1变为01
   function formatTime(time) {
       if (time < 10) {
           time = "0" + time;
       }
       return time.toString();
   }

   Date.prototype.getDayOfWeek = function (lang) {
       if (lang !== "cn" && lang !== "en") {
           lang = "cn";
       }

       let weekObj = {
           "cn": [
               "星期日",
               "星期一",
               "星期二",
               "星期三",
               "星期四",
               "星期五",
               "星期六",
           ],
           "en": [
               "Sunday",
               "Monday",
               "Tuesday",
               "Wednesday",
               "Thursday",
               "Friday",
               "Saturday"
           ]
       };
       return weekObj[lang][this.getDay()];
   };

   document.onchange = function (e) {
       if (e.target === select_year || e.target === select_month) {
           updateDay();
       }
   };
    //更新日期选择框
    function updateDay() {
        let day_29 =  select_day.children[28];
        let day_30 =  select_day.children[29];
        let day_31 =  select_day.children[30];

        switch (select_month.value){
            case "1":
            case "3":
            case "5":
            case "7":
            case "8":
            case "10":
            case "12":
                day_29.hidden = false;
                day_30.hidden = false;
                day_31.hidden = false;
                break;
            case "4":
            case "6":
            case "9":
            case "11":
                day_29.hidden = false;
                day_30.hidden = false;
                day_31.hidden = true;
                if (day_31.selected) {
                    day_30.selected = true;
                }
                break;
            case "2":
                if(checkYear(select_year.value)) {
                    // 闰年
                    day_29.hidden = false;
                    day_30.hidden = true;
                    day_31.hidden = true;
                    // 如果选择的是被隐藏选项，自动更新到最后一个显示的选项
                    if (day_30.selected || day_31.selected) {
                        day_29.selected = true;
                    }
                } else {
                    //平年
                    day_29.hidden = true;
                    day_30.hidden = true;
                    day_31.hidden = true;
                    if (day_30.selected || day_31.selected || day_29.selected) {
                        day_29.previousElementSibling.selected = true;
                    }
                }
        }
    }
    // 闰年返回true,否则false
    function checkYear(year) {
        let year_num = parseInt(year);
        return year_num % 400 === 0 || (year_num % 4 === 0 && year_num % 100 !== 0);
    }
</script>
</html>